generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["driverAdapters"]
}

datasource db {
    provider = "sqlite"
    url      = "file:./dev.db"
}

model User {
    id           Int            @id @default(autoincrement())
    email        String         @unique
    firstName    String
    lastName     String?
    password     String
    role         Role           @default(CUSTOMER)
    verified     Boolean        @default(false)
    createdAt    DateTime       @default(now())
    updatedAt    DateTime       @updatedAt
    orders       Product[]
    RefreshToken RefreshToken[]
    Order        Order[]
}

model RefreshToken {
    id        Int      @id @default(autoincrement())
    tokenHash String
    userId    Int
    user      User     @relation(fields: [userId], references: [id])
    createdAt DateTime @default(now())
    expiresAt DateTime
}

model Brand {
    id          Int       @id @default(autoincrement())
    name        String    @unique
    description String?
    logoUrl     String?
    websiteUrl  String?
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt
    products    Product[]
}

model Category {
    id            Int        @id @default(autoincrement())
    name          String     @unique
    parentId      Int?
    parent        Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
    subCategories Category[] @relation("CategoryHierarchy")
    products      Product[]
}

model Product {
    id          Int       @id @default(autoincrement())
    name        String    @unique
    description String?
    brandId     Int
    brand       Brand     @relation(fields: [brandId], references: [id])
    userId      Int?
    User        User?     @relation(fields: [userId], references: [id])
    categoryId  Int?
    Category    Category? @relation(fields: [categoryId], references: [id])
    Order       Order[]
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt
}

model Order {
    id              Int      @id @default(autoincrement())
    userId          Int
    user            User     @relation(fields: [userId], references: [id])
    productId       Int
    product         Product  @relation(fields: [productId], references: [id])
    quantity        Int      @default(1)
    priceAtPurchase Float
    createdAt       DateTime @default(now())
}

enum Role {
    CUSTOMER
    SELLER
    ADMIN
}
